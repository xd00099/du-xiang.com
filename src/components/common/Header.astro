---
const navLinks = [
  { href: "#about", label: "About", icon: "user" },
  { href: "#work", label: "Work", icon: "briefcase" },
  { href: "#projects", label: "Projects", icon: "code" },
  { href: "#contact", label: "Contact", icon: "mail" },
];
---

<aside class="sidebar" id="sidebar">
  <div class="scroll-progress" id="scroll-progress"></div>
  <div class="sidebar-inner">
    <a href="#home" class="logo">
      <span class="logo-text">DX</span>
    </a>

    <nav class="nav">
      {navLinks.map((link) => (
        <a href={link.href} class="nav-link" data-tooltip={link.label}>
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            {link.icon === "user" && (
              <><circle cx="12" cy="8" r="4"/><path d="M4 21v-1a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v1"/></>
            )}
            {link.icon === "briefcase" && (
              <><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></>
            )}
            {link.icon === "code" && (
              <><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></>
            )}
            {link.icon === "mail" && (
              <><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 6-10 7L2 6"/></>
            )}
          </svg>
          <span class="nav-label">{link.label}</span>
        </a>
      ))}
    </nav>

    <div class="sidebar-footer">
      <a href="https://github.com/xd00099" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="GitHub">
        <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
      <a href="https://www.linkedin.com/in/du-xiang" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
          <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
        </svg>
      </a>
    </div>
  </div>
</aside>

<!-- Mobile header -->
<header class="mobile-header" id="mobile-header">
  <a href="#home" class="logo-mobile">DX</a>
  <button class="mobile-toggle" aria-label="Menu" id="mobile-toggle">
    <span></span>
    <span></span>
  </button>
</header>

<!-- Mobile nav overlay -->
<div class="mobile-nav-overlay" id="mobile-nav-overlay">
  <nav class="mobile-nav">
    {navLinks.map((link) => (
      <a href={link.href} class="mobile-nav-link">{link.label}</a>
    ))}
  </nav>
</div>

<style>
  /* Desktop Sidebar */
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 72px;
    background: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-right: 1px solid var(--color-border);
    z-index: 1000;
    display: flex;
    flex-direction: column;
  }

  .scroll-progress {
    position: absolute;
    top: 0;
    left: 0;
    width: 2px;
    height: 0%;
    background: linear-gradient(180deg, #6366f1 0%, #8b5cf6 100%);
    transition: height 0.1s ease-out;
    z-index: 1001;
    box-shadow: 0 0 10px rgba(99, 102, 241, 0.5),
                0 0 20px rgba(139, 92, 246, 0.3);
  }

  .sidebar-inner {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: var(--space-6) 0;
  }

  .logo {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
    margin-bottom: var(--space-8);
  }

  .logo-text {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #fff 0%, #a0a0a0 100%);
    color: #000;
    font-weight: 700;
    font-size: var(--text-sm);
    border-radius: 10px;
    transition: transform var(--duration-fast) var(--ease-out);
  }

  .logo:hover .logo-text {
    transform: scale(1.05);
  }

  .nav {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding: 0 var(--space-3);
    flex: 1;
  }

  .nav-link {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    margin: 0 auto;
    border-radius: 12px;
    color: var(--color-text-muted);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .nav-link:hover {
    background: var(--color-bg-elevated);
    color: var(--color-text);
  }

  /* Active state */
  .nav-link.active {
    color: var(--color-text);
    background: rgba(99, 102, 241, 0.1);
    box-shadow: 0 0 20px rgba(99, 102, 241, 0.15);
  }

  .nav-link.active .nav-icon {
    filter: drop-shadow(0 0 4px rgba(139, 92, 246, 0.5));
  }

  .nav-link.active::before {
    content: '';
    position: absolute;
    left: -12px;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 24px;
    background: linear-gradient(180deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 0 2px 2px 0;
    box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
    animation: slideIn 0.2s ease;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-50%) scaleY(0);
    }
    to {
      opacity: 1;
      transform: translateY(-50%) scaleY(1);
    }
  }

  .nav-link::after {
    content: attr(data-tooltip);
    position: absolute;
    left: calc(100% + 12px);
    padding: var(--space-2) var(--space-3);
    background: var(--color-bg-elevated);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-size: var(--text-sm);
    color: var(--color-text);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transform: translateX(-4px);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .nav-link:hover::after {
    opacity: 1;
    transform: translateX(0);
  }

  .nav-icon {
    width: 20px;
    height: 20px;
  }

  .nav-label {
    display: none;
  }

  .sidebar-footer {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    border-top: 1px solid var(--color-border);
  }

  .social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    color: var(--color-text-muted);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .social-link:hover {
    background: var(--color-bg-elevated);
    color: var(--color-text);
  }

  /* Mobile Header */
  .mobile-header {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--color-border);
    z-index: 1000;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--space-5);
  }

  .logo-mobile {
    font-weight: 700;
    font-size: var(--text-lg);
    color: var(--color-text);
  }

  .mobile-toggle {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    width: 32px;
    height: 32px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
  }

  .mobile-toggle span {
    display: block;
    width: 100%;
    height: 2px;
    background: var(--color-text);
    border-radius: 1px;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .mobile-toggle.active span:first-child {
    transform: rotate(45deg) translate(3px, 3px);
  }

  .mobile-toggle.active span:last-child {
    transform: rotate(-45deg) translate(3px, -3px);
  }

  .mobile-nav-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 999;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--duration-base) var(--ease-out);
  }

  .mobile-nav-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  .mobile-nav {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-6);
  }

  .mobile-nav-link {
    font-size: var(--text-3xl);
    font-weight: 500;
    color: var(--color-text-secondary);
    transition: all var(--duration-fast) var(--ease-out);
    position: relative;
  }

  .mobile-nav-link:hover {
    color: var(--color-text);
  }

  .mobile-nav-link.active {
    color: var(--color-text);
  }

  .mobile-nav-link.active::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 50%;
  }

  @media (max-width: 768px) {
    .sidebar {
      display: none;
    }

    .mobile-header,
    .mobile-nav-overlay {
      display: flex;
    }
  }
</style>

<script>
  const toggle = document.getElementById('mobile-toggle');
  const overlay = document.getElementById('mobile-nav-overlay');

  toggle?.addEventListener('click', () => {
    toggle.classList.toggle('active');
    overlay?.classList.toggle('active');
  });

  document.querySelectorAll('.mobile-nav-link').forEach(link => {
    link.addEventListener('click', () => {
      toggle?.classList.remove('active');
      overlay?.classList.remove('active');
    });
  });

  // Scroll spy functionality
  const sections = document.querySelectorAll('section[id]');
  const navLinks = document.querySelectorAll('.nav-link');
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  const scrollProgress = document.getElementById('scroll-progress');

  function updateActiveLink() {
    const scrollPosition = window.scrollY + window.innerHeight / 3;

    let currentSection = '';

    sections.forEach(section => {
      const sectionTop = section.offsetTop;
      const sectionHeight = section.offsetHeight;
      const sectionId = section.getAttribute('id');

      if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
        currentSection = sectionId || '';
      }
    });

    // Update desktop nav
    navLinks.forEach(link => {
      link.classList.remove('active');
      const href = link.getAttribute('href');
      if (href === `#${currentSection}`) {
        link.classList.add('active');
      }
    });

    // Update mobile nav
    mobileNavLinks.forEach(link => {
      link.classList.remove('active');
      const href = link.getAttribute('href');
      if (href === `#${currentSection}`) {
        link.classList.add('active');
      }
    });

    // Update scroll progress
    const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = (window.scrollY / totalHeight) * 100;
    if (scrollProgress) {
      scrollProgress.style.height = `${progress}%`;
    }
  }

  // Throttle scroll events for performance
  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        updateActiveLink();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Initial check
  updateActiveLink();
</script>
